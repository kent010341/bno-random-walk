<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Random Walk GIF - Bigger Hitbox</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #fff;
            cursor: pointer;
        }

        .bno-wrapper {
            position: absolute;
            pointer-events: auto;
            user-select: none;
        }

        .bno {
            width: 80px;
            height: auto;
            display: block;
            pointer-events: none;
        }
    </style>
</head>

<body>

    <script>
        function createBno(x, y) {
            const wrapper = document.createElement("div");
            wrapper.className = "bno-wrapper";

            const img = document.createElement("img");
            img.src = "assets/walk.gif";
            img.className = "bno";
            wrapper.appendChild(img);
            document.body.appendChild(wrapper);

            const hitboxPadding = 20;

            let posX = x;
            let posY = y;

            const speed = 10;
            const interval = 50 + Math.random() * 50;

            function layout() {
                const w = img.offsetWidth + hitboxPadding * 2;
                const h = img.offsetHeight + hitboxPadding * 2;

                wrapper.style.width = w + "px";
                wrapper.style.height = h + "px";

                // GIF 置中
                img.style.position = "absolute";
                img.style.left = hitboxPadding + "px";
                img.style.top = hitboxPadding + "px";

                wrapper.style.left = posX + "px";
                wrapper.style.top = posY + "px";
            }

            function move() {
                const angle = Math.random() * Math.PI * 2;
                const dx = Math.cos(angle) * speed;
                const dy = Math.sin(angle) * speed;

                posX += dx;
                posY += dy;

                const w = wrapper.offsetWidth;
                const h = wrapper.offsetHeight;

                if (posX < 0) posX = 0;
                if (posY < 0) posY = 0;
                if (posX + w > window.innerWidth) posX = window.innerWidth - w;
                if (posY + h > window.innerHeight) posY = window.innerHeight - h;

                wrapper.style.left = posX + "px";
                wrapper.style.top = posY + "px";
            }

            layout();

            const timer = setInterval(move, interval);

            wrapper.addEventListener("click", (e) => {
                e.stopPropagation();
                clearInterval(timer);
                wrapper.remove();
            });

            img.onload = layout;
        }

        document.addEventListener("click", (event) => {
            createBno(event.clientX, event.clientY);
        });

        // create one BNO at init
        createBno(window.innerWidth / 2, window.innerHeight / 2);

        window.addEventListener("resize", () => {
            document.querySelectorAll(".bno-wrapper").forEach(wrapper => {
                const x = Math.min(parseInt(wrapper.style.left), window.innerWidth - wrapper.offsetWidth);
                const y = Math.min(parseInt(wrapper.style.top), window.innerHeight - wrapper.offsetHeight);
                wrapper.style.left = x + "px";
                wrapper.style.top = y + "px";
            });
        });
    </script>

</body>

</html>
